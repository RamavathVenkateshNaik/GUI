<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Carrier Concentration</title>
  <style>
    body { font-family: system-ui, Arial, sans-serif; margin: 16px; }
    .grid { display: grid; grid-template-columns: 340px 1fr; gap: 16px; align-items: start; }
    .card { border: 1px solid #e5e7eb; border-radius: 12px; padding: 16px; box-shadow: 0 1px 2px rgba(0,0,0,0.04); }
    .row { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }
    label { display: block; font-size: 14px; color: #374151; margin-bottom: 4px; }
    input, select, button {
      width: 100%; padding: 10px; border: 1px solid #d1d5db; border-radius: 8px; font-size: 14px;
    }
    button { background: #111827; color: #fff; cursor: pointer; }
    button:hover { background: #0b0f1a; }
    .vals { display: grid; grid-template-columns: repeat(2, minmax(0,1fr)); gap: 8px; margin-top: 12px; }
    .kv { background: #f9fafb; border: 1px solid #eef2f7; padding: 10px; border-radius: 8px; }
    .kv .k { color: #6b7280; font-size: 12px; }
    .kv .v { font-weight: 600; margin-top: 2px; font-family: ui-monospace, SFMono-Regular, Menlo, monospace; }
    img { max-width: 100%; height: auto; border-radius: 8px; border: 1px solid #e5e7eb; }
    .past { margin-top: 16px; display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; }
    .err { color: #b91c1c; margin: 8px 0; }
  </style>
</head>
<body>
  <h1>Carrier Concentration (n(x))</h1>
  <div class="grid">

    <!-- LEFT: Controls + values -->
    <div class="card">
      <form id="f">
        <div class="row">
          <div>
            <label for="temperature">Temperature (K)</label>
            <select id="temperature" name="temperature" required>
              {% for t in temperatures %}
                <option value="{{t}}">{{t}}</option>
              {% endfor %}
            </select>
          </div>
          <div>
            <label for="layers">Layers</label>
            <select id="layers" name="layers" required>
              {% for l in layers %}
                <option value="{{l}}">{{l}}</option>
              {% endfor %}
            </select>
          </div>
        </div>

        <div style="margin-top:8px;">
          <label for="voltage">Gate Voltage (V)</label>
          <input id="voltage" name="voltage" type="number" step="0.0001" placeholder="e.g. 0.0871" required />
        </div>

        <div style="margin-top:12px;">
          <button type="submit">Compute n(x)</button>
        </div>
      </form>

      <div id="err" class="err" style="display:none;"></div>

      <div id="vals" class="vals" style="display:none;">
        <div class="kv"><div class="k">a0</div><div class="v" id="v_a0">—</div></div>
        <div class="kv"><div class="k">a1</div><div class="v" id="v_a1">—</div></div>
        <div class="kv"><div class="k">n0</div><div class="v" id="v_n0">—</div></div>
        <div class="kv"><div class="k">n1</div><div class="v" id="v_n1">—</div></div>
        <div class="kv"><div class="k">n_max (from file)</div><div class="v" id="v_nmax">—</div></div>
        <div class="kv"><div class="k">TSI (nm)</div><div class="v" id="v_tsi">—</div></div>
      </div>
    </div>

    <!-- RIGHT: Main graph -->
    <div class="card">
      <div><img id="main" alt="carrier concentration" src="" /></div>
    </div>
  </div>

  <!-- Past data grid -->
  <div class="card">
    <h3>Past Data (same V across other T, Layers)</h3>
    <div id="past" class="past"></div>
  </div>

<script>
const f = document.getElementById("f");
const err = document.getElementById("err");
const vals = document.getElementById("vals");

f.addEventListener("submit", async (e) => {
  e.preventDefault();
  err.style.display = "none";

  const fd = new FormData(f);
  const res = await fetch("/predict", { method: "POST", body: fd });
  const data = await res.json();

  if (!res.ok) {
    err.textContent = data.error || "Something went wrong.";
    err.style.display = "block";
    return;
  }

  // Update parameter cards
  vals.style.display = "grid";
  document.getElementById("v_a0").textContent   = data.params.a0.toFixed(6);
  document.getElementById("v_a1").textContent   = data.params.a1.toFixed(6);
  document.getElementById("v_n0").textContent   = data.params.n0.toFixed(6);
  document.getElementById("v_n1").textContent   = data.params.n1.toFixed(6);
  document.getElementById("v_nmax").textContent = data.params.n_max.toExponential(4);
  document.getElementById("v_tsi").textContent  = data.params.tsi.toFixed(5);

  // Main graph
  document.getElementById("main").src = "data:image/png;base64," + data.main_graph;

  // Past data cards
  const past = document.getElementById("past");
  past.innerHTML = "";
  data.past_graphs.forEach(p => {
    const div = document.createElement("div");
    div.className = "card";
    div.innerHTML = `
      <div style="font-size:14px; margin-bottom:6px;">
        <strong>${p.temp}K, ${p.layers}L</strong><br/>
        a0=${p.a0.toFixed(4)}, a1=${p.a1.toFixed(4)}, n0=${p.n0.toFixed(4)}, n1=${p.n1.toFixed(4)}<br/>
        n_max=${Number(p.n_max).toExponential(4)}
      </div>
      <img src="data:image/png;base64,${p.graph}" alt="past graph"/>
    `;
    past.appendChild(div);
  });
});
</script>
</body>
</html>
